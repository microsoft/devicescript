"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1382],{35318:(e,t,i)=>{i.d(t,{Zo:()=>m,kt:()=>h});var n=i(27378);function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){r(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function l(e,t){if(null==e)return{};var i,n,r=function(e,t){if(null==e)return{};var i,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),i=t;return e&&(i="function"==typeof e?e(t):o(o({},t),e)),i},m=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var i=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),d=p(i),c=r,h=d["".concat(s,".").concat(c)]||d[c]||u[c]||a;return i?n.createElement(h,o(o({ref:t},m),{},{components:i})):n.createElement(h,o({ref:t},m))}));function h(e,t){var i=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=i.length,o=new Array(a);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:r,o[1]=l;for(var p=2;p<a;p++)o[p]=i[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,i)}c.displayName="MDXCreateElement"},61776:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>p});var n=i(25773),r=(i(27378),i(35318));const a={sidebar_position:6,description:"Learn how to integrate a humidity sensor with HomeKit using HomeBridge, MQTT server, and DeviceScript Gateway.",keywords:["Homebridge","HomeKit","humidity sensor","MQTT","DeviceScript Gateway"],hide_table_of_contents:!0},o="Homebridge + Humidity Sensor",l={unversionedId:"samples/homebridge-humidity",id:"samples/homebridge-humidity",title:"Homebridge + Humidity Sensor",description:"Learn how to integrate a humidity sensor with HomeKit using HomeBridge, MQTT server, and DeviceScript Gateway.",source:"@site/docs/samples/homebridge-humidity.mdx",sourceDirName:"samples",slug:"/samples/homebridge-humidity",permalink:"/devicescript/samples/homebridge-humidity",draft:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6,description:"Learn how to integrate a humidity sensor with HomeKit using HomeBridge, MQTT server, and DeviceScript Gateway.",keywords:["Homebridge","HomeKit","humidity sensor","MQTT","DeviceScript Gateway"],hide_table_of_contents:!0},sidebar:"tutorialSidebar",previous:{title:"Temperature + MQTT",permalink:"/devicescript/samples/temperature-mqtt"},next:{title:"Thermostat + Gateway",permalink:"/devicescript/samples/thermostat-gateway"}},s={},p=[{value:"MQTT server configuration",id:"mqtt-server-configuration",level:2},{value:"Device Gateway configuration",id:"device-gateway-configuration",level:2},{value:"HomeBridge configuration",id:"homebridge-configuration",level:2},{value:"Programming with simulators",id:"programming-with-simulators",level:2},{value:"Programming hardware",id:"programming-hardware",level:2},{value:"Managing the device with the Gateway",id:"managing-the-device-with-the-gateway",level:2},{value:"Next steps",id:"next-steps",level:2}],m={toc:p},d="wrapper";function u(e){let{components:t,...i}=e;return(0,r.kt)(d,(0,n.Z)({},m,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"homebridge--humidity-sensor"},"Homebridge + Humidity Sensor"),(0,r.kt)("p",null,"In this sample, we will use ",(0,r.kt)("a",{parentName:"p",href:"https://homebridge.io/"},"HomeBridge")," to integrate our device with Apple HomeKit. As an example, we will expose a humidity sensor to HomeKit."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://homebridge.io/"},"HomeBridge")," allows you to integrate with smart home devices that do not natively support HomeKit.\nUsing the ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/homebridge-mqttthing"},"HomeBridge MQTTThing plugin"),", you can integrate your MQTT Things with HomeKit.\nThe ",(0,r.kt)("a",{parentName:"p",href:"/developer/development-gateway/gateway"},"DeviceScript Gateway")," can be configured to route ",(0,r.kt)("a",{parentName:"p",href:"/developer/development-gateway/messages"},"cloud messages")," to a MQTT server which can then be used by HomeBridge."),(0,r.kt)("mermaid",{value:"stateDiagram-v2\n    device --\x3e gateway\n    gateway --\x3e MQTT\n    MQTT --\x3e hb\n    hb --\x3e HomeKit\n\n    MQTT: MQTT server\n    gateway: DeviceScript Gateway\n    hb: HomeBridge\n    hb: HomeBridge MQTTThing"}),(0,r.kt)("h2",{id:"mqtt-server-configuration"},"MQTT server configuration"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Start a MQTT server. You can find a ",(0,r.kt)("a",{parentName:"li",href:"https://mqtt.org/software/"},"list of servers here"),".")),(0,r.kt)("p",null,"You will need the URL, port and optionaly username, password to configure the gateway."),(0,r.kt)("h2",{id:"device-gateway-configuration"},"Device Gateway configuration"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Clone or create a ",(0,r.kt)("a",{parentName:"li",href:"/developer/development-gateway/gateway"},"DeviceScript Gateway")," (by starting a GitHub Codespace for example)"),(0,r.kt)("li",{parentName:"ul"},"Configure it to route the messages to the MQTT server"),(0,r.kt)("li",{parentName:"ul"},"Start the development server. If you are using GitHub Codespaces, make sure to change the visibility of the port to ",(0,r.kt)("inlineCode",{parentName:"li"},"Public")," in the ",(0,r.kt)("inlineCode",{parentName:"li"},"Ports")," pane."),(0,r.kt)("li",{parentName:"ul"},"Copy the connection string that is printed in the terminal output and enter it in the ",(0,r.kt)("inlineCode",{parentName:"li"},"DeviceScript Gateway")," pane in Visual Studio Code. You should get a confirmation that the gateway is connected.")),(0,r.kt)("h2",{id:"homebridge-configuration"},"HomeBridge configuration"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Install ",(0,r.kt)("a",{parentName:"li",href:"https://homebridge.io/"},"HomeBridge")),(0,r.kt)("li",{parentName:"ul"},"Open the plugins pane and install the ",(0,r.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/homebridge-mqttthing"},"HomeBridge MQTTThing plugin")," plugin"),(0,r.kt)("li",{parentName:"ul"},"Click on ",(0,r.kt)("inlineCode",{parentName:"li"},"SETTINGS")," for the MQTTThing plugin and add a ",(0,r.kt)("strong",{parentName:"li"},"Humidity Sensor")," accessory"),(0,r.kt)("li",{parentName:"ul"},"Configure the MQTT settings to connect to the MQTT server"),(0,r.kt)("li",{parentName:"ul"},"Scroll down to the ",(0,r.kt)("strong",{parentName:"li"},"MQTT topics")," and set the ",(0,r.kt)("inlineCode",{parentName:"li"},"get Humidity")," topic to ",(0,r.kt)("inlineCode",{parentName:"li"},"humidity"))),(0,r.kt)("h2",{id:"programming-with-simulators"},"Programming with simulators"),(0,r.kt)("p",null,"We can start programming with devicescript by using the simulator. The simulator allows you to test your code without having to deploy it to a physical device."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Create a new DeviceScript project using the ",(0,r.kt)("inlineCode",{parentName:"li"},"DeviceScript: New Project")," command"),(0,r.kt)("li",{parentName:"ul"},"Open ",(0,r.kt)("inlineCode",{parentName:"li"},"main.ts")," and add the following code and click the ",(0,r.kt)("inlineCode",{parentName:"li"},"Run")," icon on the file menu.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'import { Humidity } from "@devicescript/core"\nimport { throttleTime } from "@devicescript/observables"\n\nconst sensor = new Humidity()\nsensor.reading.pipe(throttleTime(5000)).subscribe(humidity => {\n    console.data({ humidity })\n})\n')),(0,r.kt)("p",null,"Once the simulator is running and you start the humidity sensor simulator, you should see the humidity readings in the console."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Open the ",(0,r.kt)("inlineCode",{parentName:"li"},"DeviceScript Gateway")," pane"),(0,r.kt)("li",{parentName:"ul"},"Click on the ",(0,r.kt)("inlineCode",{parentName:"li"},"+")," near devices to register the simulator")),(0,r.kt)("p",null,"Update the program to publish the humidity readings to the cloud."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'import { Humidity } from "@devicescript/core"\nimport { throttleTime } from "@devicescript/observables"\n// highlight-next-line\nimport { publishMessage } from "@devicescript/cloud"\n\nconst sensor = new Humidity()\nsensor.reading.pipe(throttleTime(5000)).subscribe(async humidity => {\n    console.data({ humidity })\n    // highlight-next-line\n    await publishMessage("/humidity", { humidity })\n})\n')),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Notice that the topic starts with ",(0,r.kt)("inlineCode",{parentName:"p"},"/"),". By default DeviceScript routes topics to ",(0,r.kt)("inlineCode",{parentName:"p"},"devs/{deviceid}/from/{topic}"),". Starting the topic with ",(0,r.kt)("inlineCode",{parentName:"p"},"/")," disables this mode.")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"open HomeBridge and you should see the humidity being updated from the values on the sensor. Try to move the slider on the humidity sensor simulator to verify that the values are updated.")),(0,r.kt)("h2",{id:"programming-hardware"},"Programming hardware"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Click the ",(0,r.kt)("inlineCode",{parentName:"li"},"plug")," icon and connect your device"),(0,r.kt)("li",{parentName:"ul"},"Click on the magic wand icon on the file menu and select your hardware device. Then add the code to connect to the ",(0,r.kt)("inlineCode",{parentName:"li"},"startSHTC3"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'import { Humidity } from "@devicescript/core"\nimport { throttleTime } from "@devicescript/observables"\nimport { publishMessage } from "@devicescript/cloud"\n// highlight-next-line\nimport { startSHTC3 } from "@devicescript/drivers"\n\n// highlight-next-line\nconst { humidity: sensor } = await startSHTC3()\n\nsensor.reading.pipe(throttleTime(5000)).subscribe(async humidity => {\n    console.data({ humidity })\n    await publishMessage("/humidity", { humidity })\n})\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Click the play button to deploy the script to your board and test it.")),(0,r.kt)("h2",{id:"managing-the-device-with-the-gateway"},"Managing the device with the Gateway"),(0,r.kt)("p",null,"The last step is to upload the script to the gateway and assign this script to the device. The gateway will automatically deploy the script to the device."),(0,r.kt)("p",null,"In the Device Gateway view,"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Click ",(0,r.kt)("inlineCode",{parentName:"li"},"+")," next to script and add your script"),(0,r.kt)("li",{parentName:"ul"},"Click ",(0,r.kt)("inlineCode",{parentName:"li"},"script")," icon near the device and assign the script you've just uploaded")),(0,r.kt)("h2",{id:"next-steps"},"Next steps"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"If you want to continue iterating locally, make sure to clear the script assigned to your device (the extension will remind)."),(0,r.kt)("li",{parentName:"ul"},"If you upload a new version of the script, make sure to update the assigned script on the device too.")))}u.isMDXComponent=!0}}]);