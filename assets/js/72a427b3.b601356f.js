"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5360],{35318:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>k});var i=n(27378);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},l=Object.keys(e);for(i=0;i<l.length;i++)n=l[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(i=0;i<l.length;i++)n=l[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),p=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return i.createElement(s.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,s=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),d=p(n),m=a,k=d["".concat(s,".").concat(m)]||d[m]||c[m]||l;return n?i.createElement(k,o(o({ref:t},u),{},{components:n})):i.createElement(k,o({ref:t},u))}));function k(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,o=new Array(l);o[0]=m;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r[d]="string"==typeof e?e:a,o[1]=r;for(var p=2;p<l;p++)o[p]=n[p];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},82177:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>c,frontMatter:()=>l,metadata:()=>r,toc:()=>p});var i=n(25773),a=(n(27378),n(35318));const l={sidebar_position:101,title:"Contributing"},o="Contributing",r={unversionedId:"contributing",id:"contributing",title:"Contributing",description:"Contributions are welcome! DeviceScript takes pull requests.",source:"@site/docs/contributing.mdx",sourceDirName:".",slug:"/contributing",permalink:"/devicescript/contributing",draft:!1,tags:[],version:"current",sidebarPosition:101,frontMatter:{sidebar_position:101,title:"Contributing"},sidebar:"tutorialSidebar",previous:{title:"Release Notes",permalink:"/devicescript/changelog"}},s={},p=[{value:"Contributions",id:"contributions",level:2},{value:"Samples",id:"samples",level:3},{value:"Local development",id:"local-development",level:2},{value:"Repository structure",id:"repository-structure",level:3},{value:"Compiler, runtime and command line",id:"compiler-runtime-and-command-line",level:3},{value:"Visual Studio Extension",id:"visual-studio-extension",level:3},{value:"Building packages",id:"building-packages",level:3},{value:"Documentation",id:"documentation",level:3},{value:"Add Core JavaScript APIs",id:"add-core-javascript-apis",level:3},{value:"Documenting/patching console output",id:"documentingpatching-console-output",level:3},{value:"Adding Builtin Packages",id:"adding-builtin-packages",level:3},{value:"Release process",id:"release-process",level:2},{value:"Legal",id:"legal",level:2}],u={toc:p},d="wrapper";function c(e){let{components:t,...n}=e;return(0,a.kt)(d,(0,i.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"contributing"},"Contributing"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Contributions are welcome!")," DeviceScript takes pull requests."),(0,a.kt)("h2",{id:"contributions"},"Contributions"),(0,a.kt)("p",null,"We have a few guides to help with specific contributions."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/developer/drivers/add-driver"},"add a new driver")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/devices/add-board"},"add a new board")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/devices/add-shield"},"add a new shield")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/devices/add-soc"},"add a new SOC"))),(0,a.kt)("h3",{id:"samples"},"Samples"),(0,a.kt)("p",null,"Documentation samples are located under ",(0,a.kt)("inlineCode",{parentName:"p"},"website/docs/samples"),".\nEach ",(0,a.kt)("inlineCode",{parentName:"p"},".mdx")," file contains a single self-contained sample."),(0,a.kt)("p",null,"It is typically easiest to develop a sample in a dedicate ",(0,a.kt)("inlineCode",{parentName:"p"},".ts")," file\nto leverage the editor's features, and then copy it to the ",(0,a.kt)("inlineCode",{parentName:"p"},".mdx")," file."),(0,a.kt)("p",null,"To run the docs locally, run ",(0,a.kt)("inlineCode",{parentName:"p"},"yarn docs"),". This will launch the docusaurus development server\nand refresh the documentation page on each edit."),(0,a.kt)("p",null,"If your sample requires multiple files, such as images,"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"create a folder with the same name as the ",(0,a.kt)("inlineCode",{parentName:"li"},".mdx")," file"),(0,a.kt)("li",{parentName:"ul"},"move your ",(0,a.kt)("inlineCode",{parentName:"li"},".mdx")," file and rename it to ",(0,a.kt)("inlineCode",{parentName:"li"},"index.mdx")),(0,a.kt)("li",{parentName:"ul"},"add a ",(0,a.kt)("inlineCode",{parentName:"li"},"_category_.json")," file with the front matter")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "label": "Samples",\n    "position": 3\n}\n')),(0,a.kt)("h2",{id:"local-development"},"Local development"),(0,a.kt)("p",null,"The development requirement will vary (widely) depending\non which part of DeviceScript you want to work on."),(0,a.kt)("p",null,"Using Visual Studio Code is strongly recommended."),(0,a.kt)("h3",{id:"repository-structure"},"Repository structure"),(0,a.kt)("p",null,"This repository contains:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/microsoft/jacdac-c"},"jacdac-c submodule"),", including sources for Jacdac client libraries and DeviceScript VM"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"compiler/")," - sources for DeviceScript compiler"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"runtime/devicescript-vm/")," - glue files to build DeviceScript VM as WASM module using ",(0,a.kt)("a",{parentName:"li",href:"https://emscripten.org/"},"emscripten"),"; ",(0,a.kt)("inlineCode",{parentName:"li"},"vm/dist/")," contain pre-built files"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"packages")," - builtin packages and sample project (",(0,a.kt)("inlineCode",{parentName:"li"},"packages/sampleprj"),")"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"runtime/posix/")," - implementation of Jacdac SDK HAL for grown-up POSIX-like operating systems (as opposed to embedded platforms)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"vscode")," - Visual Studio Code extension"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"website")," - docusaurus documentation side")),(0,a.kt)("h3",{id:"compiler-runtime-and-command-line"},"Compiler, runtime and command line"),(0,a.kt)("p",null,"You can use the devcontainer to build. The instructions are tested for a Unix terminal."),(0,a.kt)("p",null,"If you want to build locally you need to install node.js. After cloning, the repo run"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"yarn setup\n")),(0,a.kt)("p",null,"To run a watch build and the docs, run"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"nvm use 18\nyarn dev\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"start ",(0,a.kt)("inlineCode",{parentName:"li"},"jacdac devtools")," (the npm version) and let it run"),(0,a.kt)("li",{parentName:"ul"},'open this folder in VSCode; use "Reopen in Container" if needed'),(0,a.kt)("li",{parentName:"ul"},"start Terminal in VSCode"),(0,a.kt)("li",{parentName:"ul"},"run ",(0,a.kt)("inlineCode",{parentName:"li"},"yarn install")),(0,a.kt)("li",{parentName:"ul"},"run ",(0,a.kt)("inlineCode",{parentName:"li"},"yarn build")),(0,a.kt)("li",{parentName:"ul"},"run ",(0,a.kt)("inlineCode",{parentName:"li"},"yarn devs run devs/samples/something.ts")," - this will execute given DeviceScript program using the WASM binary")),(0,a.kt)("p",null,"If you want to develop the runtime (as opposed to compiler or website), you will also need\nGNU Make, C compiler, and ",(0,a.kt)("a",{parentName:"p",href:"https://emscripten.org/docs/getting_started/downloads.html"},"emscripten"),".\nOnce you have it all:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"run ",(0,a.kt)("inlineCode",{parentName:"li"},"make native")," to compile using native C compiler"),(0,a.kt)("li",{parentName:"ul"},"run ",(0,a.kt)("inlineCode",{parentName:"li"},"yarn devs crun devs/samples/something.ts")," - this will execute given DeviceScript program using the POSIX/native binary"),(0,a.kt)("li",{parentName:"ul"},"run ",(0,a.kt)("inlineCode",{parentName:"li"},"./runtime/built/jdcli 8082")," - this will run the POSIX/native DeviceScript server, which can be accessed from the devtools dashboard"),(0,a.kt)("li",{parentName:"ul"},"run ",(0,a.kt)("inlineCode",{parentName:"li"},"make em")," to compile using emscripten")),(0,a.kt)("p",null,"To lint sources,"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"run ",(0,a.kt)("inlineCode",{parentName:"li"},"yarn lint"))),(0,a.kt)("h3",{id:"visual-studio-extension"},"Visual Studio Extension"),(0,a.kt)("p",null,"Open the Debug view in VSCode and run the ",(0,a.kt)("inlineCode",{parentName:"p"},"VSCode Extension")," configuration. This will launch a new VSCode instance with the extension loaded. A build is automatically triggered before launch VSCode."),(0,a.kt)("h3",{id:"building-packages"},"Building packages"),(0,a.kt)("p",null,"Similar to working on the Visual Studio Code extension, lunch the ",(0,a.kt)("inlineCode",{parentName:"p"},"VSCode Extension")," debugger configuration. This will launch a new VSCode instance with the extension loaded.\nIt should also open the ",(0,a.kt)("inlineCode",{parentName:"p"},"packages")," folder which will allow you to work on the built-in packages."),(0,a.kt)("h3",{id:"documentation"},"Documentation"),(0,a.kt)("p",null,"Run ",(0,a.kt)("inlineCode",{parentName:"p"},"yarn docs")," and edit any markdown file in the ",(0,a.kt)("inlineCode",{parentName:"p"},"website/docs")," folder. The changes should be automatically picked up and rendered by docusaurus."),(0,a.kt)("h3",{id:"add-core-javascript-apis"},"Add Core JavaScript APIs"),(0,a.kt)("p",null,"The DeviceScript ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects"},"core js library")," is not complete; but it is possible to fill the gaps\nas needed. The requests are tracked by the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/microsoft/devicescript/issues?q=is%3Aissue+is%3Aopen+label%3A%22core+js%22"},"core js issue label"),"."),(0,a.kt)("p",null,"You will need a local development setup for these tasks."),(0,a.kt)("p",null,"If you want to add a new function:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"find the corresponding function definition in one of the ",(0,a.kt)("inlineCode",{parentName:"li"},"lib/es....d.ts")," file."),(0,a.kt)("li",{parentName:"ul"},"copy the definition in the corresponding interface in ",(0,a.kt)("inlineCode",{parentName:"li"},"packages/core/src/corelib.d.ts")),(0,a.kt)("li",{parentName:"ul"},"implement the function in the implementation file of the type (see ",(0,a.kt)("inlineCode",{parentName:"li"},"packages/core/src/array.ts")," for example).\nIf you are adding a new file, make sure to import it in ",(0,a.kt)("inlineCode",{parentName:"li"},"packages/core/src/index.ts"),"."),(0,a.kt)("li",{parentName:"ul"},"add test cases in the corresponding test file under ",(0,a.kt)("inlineCode",{parentName:"li"},"devs/run-tests")),(0,a.kt)("li",{parentName:"ul"},"build and test"),(0,a.kt)("li",{parentName:"ul"},"create a pull request and go!")),(0,a.kt)("p",null,"If you want to add a new Type, we currently have a limitation with the ",(0,a.kt)("inlineCode",{parentName:"p"},"core")," package and you will need to add it to the ",(0,a.kt)("inlineCode",{parentName:"p"},"runtime")," package:s"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"implement the class in the implementation file of the type (see ",(0,a.kt)("inlineCode",{parentName:"li"},"packages/runtime/src/map.ts")," for example).\nIf you are adding a new file, make sure to import it in ",(0,a.kt)("inlineCode",{parentName:"li"},"packages/runtime/src/map.ts"),"."),(0,a.kt)("li",{parentName:"ul"},"add test cases in the corresponding test file under ",(0,a.kt)("inlineCode",{parentName:"li"},"packages/runtime/src/main.ts")),(0,a.kt)("li",{parentName:"ul"},"build and test"),(0,a.kt)("li",{parentName:"ul"},"create a pull request and go!")),(0,a.kt)("h3",{id:"documentingpatching-console-output"},"Documenting/patching console output"),(0,a.kt)("p",null,"To add new substitions from console output message to pretty text + URL, do the following."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"website/docs/developer/errors.mdx")," gets parsed by builderrors.mjs.\nThe hash of the H2 titles is the console log look up key (replacing - with spaces) and the H2 text will replace that key + URL."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"loopback rx ovf --\x3e Loopback buffer overflow (....#loopback-rx-ovf)\n")),(0,a.kt)("h3",{id:"adding-builtin-packages"},"Adding Builtin Packages"),(0,a.kt)("p",null,"Adding a new package is more advanced scenario and most likely we should have a discussion prior to start this work. You are welcome to publish packages under your account in npm."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"A good question to start with: Do we need a new builtin package or should it be a new npm package?")),(0,a.kt)("p",null,"Generally, search for ",(0,a.kt)("inlineCode",{parentName:"p"},"@devicescript/gpio")," within the workspace. The main places that need updating is:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"this file, ",(0,a.kt)("inlineCode",{parentName:"li"},"website/docs/developer/packages.mdx")),(0,a.kt)("li",{parentName:"ul"},"list in ",(0,a.kt)("inlineCode",{parentName:"li"},"plugin/src/plugin.ts")),(0,a.kt)("li",{parentName:"ul"},"list in ",(0,a.kt)("inlineCode",{parentName:"li"},"devs/run-test/allcompile.ts"))),(0,a.kt)("p",null,"After adding a new packages, run ",(0,a.kt)("inlineCode",{parentName:"p"},"yarn")," at the top-level to update workspace links,\nfollowed by the usual ",(0,a.kt)("inlineCode",{parentName:"p"},"yarn build"),"."),(0,a.kt)("h2",{id:"release-process"},"Release process"),(0,a.kt)("p",null,"Run ",(0,a.kt)("inlineCode",{parentName:"p"},"yarn bump")," (or ",(0,a.kt)("inlineCode",{parentName:"p"},"make bump"),"). Alternatively, edit ",(0,a.kt)("inlineCode",{parentName:"p"},"img_version_patch")," in ",(0,a.kt)("inlineCode",{parentName:"p"},"bytecode/bytecode.md")," and push."),(0,a.kt)("p",null,"The cloud build will rebuild and check-in the VM, update version numbers in all ",(0,a.kt)("inlineCode",{parentName:"p"},"package.json")," files, and publish them."),(0,a.kt)("p",null,"If you bump minor, you need to also bump the firmware repos:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"go to each firmware repo (",(0,a.kt)("a",{parentName:"li",href:"https://github.com/microsoft/devicescript-esp32"},"https://github.com/microsoft/devicescript-esp32"),", ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/microsoft/devicescript-pico"},"https://github.com/microsoft/devicescript-pico"),", ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/microsoft/devicescript-stm32"},"https://github.com/microsoft/devicescript-stm32"),")"),(0,a.kt)("li",{parentName:"ul"},"update the ",(0,a.kt)("inlineCode",{parentName:"li"},"devicescript")," submodule"),(0,a.kt)("li",{parentName:"ul"},"run")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"make bump\n")),(0,a.kt)("h2",{id:"legal"},"Legal"),(0,a.kt)("p",null,"This project welcomes contributions and suggestions. Most contributions require you to agree to a\nContributor License Agreement (CLA) declaring that you have the right to, and actually do, grant us\nthe rights to use your contribution. For details, visit ",(0,a.kt)("a",{parentName:"p",href:"https://cla.opensource.microsoft.com"},"https://cla.opensource.microsoft.com"),"."),(0,a.kt)("p",null,"When you submit a pull request, a CLA bot will automatically determine whether you need to provide\na CLA and decorate the PR appropriately (e.g., status check, comment). Simply follow the instructions\nprovided by the bot. You will only need to do this once across all repos using our CLA."),(0,a.kt)("p",null,"This project has adopted the ",(0,a.kt)("a",{parentName:"p",href:"https://opensource.microsoft.com/codeofconduct/"},"Microsoft Open Source Code of Conduct"),".\nFor more information see the ",(0,a.kt)("a",{parentName:"p",href:"https://opensource.microsoft.com/codeofconduct/faq/"},"Code of Conduct FAQ")," or\ncontact ",(0,a.kt)("a",{parentName:"p",href:"mailto:opencode@microsoft.com"},"opencode@microsoft.com")," with any additional questions or comments."))}c.isMDXComponent=!0}}]);